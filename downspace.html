<!DOCTYPE html>
<html>


<!-- Head section is for stuff that is not going to be on the page -->
<head>
	<meta charset="utf-8" />
	<title>Gunnar Portfolio</title>
	<link rel="stylesheet" href="styles/main.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=description,groups,link,list,manufacturing" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- Favicon -->
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
	<meta name="msapplication-TileColor" content="#00aba9">
	<meta name="theme-color" content="#ffffff">
</head>

<!-- Body is for everything on the page -->
<body>
	<!-- Sticky Header with socials-->
	<div class="sticky-header">
		<a class="sticky-header-button" href="mailto: gunnarmagnum@gmail.com">gunnarmagnum@gmail.com</a>
		<a class="sticky-header-button" href="https://github.com/Raestkjoot" target="_blank">
			<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/></svg>
		</a>
		<a class="sticky-header-button" href="https://www.linkedin.com/in/gunnar-magnussen/" target="_blank">
			<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"/></svg>
		</a>
	</div>

	<!-- Header with navigation -->
	<header>
		<div>
			<h1>Gunnar Magnussen</h1>
			<p class="sub-title"><b>Game Programmer</b> | Gameplay, graphics and general game development.</p>
		</div>
		<div class="nav">
			<a class="header-button" href="index.html"> Projects </a>
			<a class="header-button" href="exp-and-edu.html"> Experience & Education </a>
			<a class="header-button" href="about-me.html"> About Me </a>
		</div>
	</header>

	<!-- TEXT -->
	 <div class="outer-text-container">
	<div class="text-container">
		<h1>Downspace</h1>
		<div class="project-overview">
			<div class="project-overview-elem">
				<iframe width="560" height="315" src="https://www.youtube.com/embed/7eOVoH1Au8A?si=I0mRSJX0gWPFveYd" title="YouTube video player" frameborder="0" 
				allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
				referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
			</iframe>
			</div>
			<div class="project-overview-elem">
				<i>
					<span class="material-symbols-outlined">manufacturing</span>
					&nbsp;<b>Engine:</b>&nbsp; Custom Engine built on renderer
				</i>
				<i>
					<span class="material-symbols-outlined">description</span>
					&nbsp;<b>Language:</b>&nbsp; C++
				</i>
				<i>
					<span class="material-symbols-outlined">list</span>
					&nbsp;<b>Tasks:</b>&nbsp; Movement | Level generation
				</i>
				<i>
					<span class="material-symbols-outlined">groups</span>
					&nbsp;<b>Team Size:</b>&nbsp; 3
				</i>
				<i>
					<span class="material-symbols-outlined">link</span>
					&nbsp;<b>Links:</b>&nbsp; <a class="links-button" href="https://github.com/Raestkjoot/Downspace" target="_blank">Source</a>
				</i>
				<i>
					Made in a proprietary engine using Simple Render Engine and Box2D Physics. 
					The game itself is heavily inspired by the precision platformer Downwell. 
					The player is falling with gunboots that allow them to jump in the air and shoot at the same time.
				</i>
			</div>
		</div>
		<hr />

		<!-- PLAYER MOVEMENT -->
		<h2>
			Player Movement
		</h2>
		<p>
			Downspace is a precision platformer, so a lot of focus was put on the collision and physics working properly. 
			One of the requirements for the project was to use a 3rd party physics library, we used Box2D which is a 2D 
			rigid body simulation library. In Downspace the ground is made up of a series of blocks, this caused a bug 
			where the player could collide with internal vertices when moving over the blocks. This not only messed with our grounded checking, 
			but would also stop the player from moving. Box2D provides
			a solution in the form of <a href="https://box2d.org/documentation/md__d_1__git_hub_box2d_docs_collision.html" target="_blank">chain shapes</a>, 
			but this would require us to dynamically calculate the outline of our levels and create a series of vertices for the collision chain.
		</p>
		<img src="images/downspace-ghost-collision.png" class="project-image"/>
		<p>
			To fix the problems, we started by making the player character use a circle collider instead of a box collider. 
			This lets the player move on top of the blocks without getting blocked by the ghost collisions. 
			Then, we needed a solution for checking if the player is grounded. For this, we developed a system 
			that could handle multiple contact points and filter out the ghost collisions.
		</p>
		<p>
			With this the player can move freely on the blocks and we are able to have really reliable grounded checking. 
			When the player attempts to jump, one of three things will happen: Jump, shoot, or nothing. 
			This depends on if the button was pressed and not held, if the player is grounded, coyote time 
			(a short time frame after leaving the ground where we can still jump), and if the player has bullets.
		</p>
		<!-- HTML generated using hilite.me --><div class="code"><pre style="margin: 0; line-height: 125%; tab-size: 4;"><span style="color: #ae81ff">bool</span> <span style="color: #66d9ef">ComponentFootContact</span>::<span style="color: #66d9ef">CanJump</span>() {
	<span style="color: #ae81ff">bool</span> coyote = 
		(<span style="color: #66d9ef">MyEngine</span>::<span style="color: #66d9ef">Engine</span>::<span style="color: #66d9ef">GetInstance</span>()-&gt;<span style="color: #66d9ef">GetTime</span>() - _lastGroundedTime)
		&lt; _coyoteTime;

	<span style="color: #ae81ff">return</span> _isGrounded || coyote;
}

<span style="color: #ae81ff">void</span> <span style="color: #66d9ef">ComponentFootContact</span>::<span style="color: #66d9ef">OnCollisionStart</span>(<span style="color: #66d9ef">ComponentPhysicsBody</span>* other, <span style="color: #66d9ef">b2Manifold</span>* manifold) {
	<span style="color: #ae81ff">if</span> (!other-&gt;<span style="color: #66d9ef">GetGameObject</span>().<span style="color: #ae81ff">lock</span>()-&gt;<span style="color: #66d9ef">GetName</span>().<span style="color: #ae81ff">rfind</span>(<span style="color: #ffbe21">&quot;Block&quot;</span>, <span style="color: #ffbe21">0</span>) == <span style="color: #ffbe21">0</span>
		|| manifold-&gt;localNormal.y &lt; <span style="color: #ffbe21">0.5f</span>) {
		<span style="color: #ae81ff">return</span>;
	}

	<span style="color: #ae81ff">auto</span> contact = std::<span style="color: #ae81ff">shared_ptr</span>&lt;<span style="color: #66d9ef">MyEngine</span>::<span style="color: #66d9ef">GameObject</span>&gt;(other-&gt;<span style="color: #66d9ef">GetGameObject</span>());
	_contacts.<span style="color: #ae81ff">push_back</span>(contact);

	<span style="color: #ae81ff">if</span> (_isGrounded == <span style="color: #ae81ff">false</span>) {
		_isGrounded = <span style="color: #ae81ff">true</span>;
		<span style="color: #ae81ff">if</span> (!_score.<span style="color: #ae81ff">expired</span>()) {
			_score.<span style="color: #ae81ff">lock</span>()-&gt;<span style="color: #66d9ef">ResetCombo</span>();
		}
		<span style="color: #ae81ff">if</span> (!_shooter.<span style="color: #ae81ff">expired</span>()) {
			_shooter.<span style="color: #ae81ff">lock</span>()-&gt;<span style="color: #66d9ef">ReloadMag</span>();
		}
	}
}

<span style="color: #ae81ff">void</span> <span style="color: #66d9ef">ComponentFootContact</span>::<span style="color: #66d9ef">OnCollisionEnd</span>(<span style="color: #66d9ef">ComponentPhysicsBody</span>* other, <span style="color: #66d9ef">b2Manifold</span>* manifold) {
	<span style="color: #ae81ff">if</span> (!other-&gt;<span style="color: #66d9ef">GetGameObject</span>().<span style="color: #ae81ff">expiredlock</span>()-&gt;<span style="color: #66d9ef">GetName</span>().<span style="color: #ae81ff">rfind</span>(<span style="color: #ffbe21">&quot;Block&quot;</span>, <span style="color: #ae81ff">0</span>) == <span style="color: #ae81ff">0</span>) {
		<span style="color: #75715e">// Sometimes the end collision is more on the side than the start collision, </span>
		<span style="color: #75715e">// so we ignore the contact normal here </span>
		<span style="color: #ae81ff">return</span>;
	}

	<span style="color: #ae81ff">auto</span> c_iter = _contacts.<span style="color: #ae81ff">begin</span>();
	<span style="color: #ae81ff">while</span> (c_iter != _contacts.<span style="color: #ae81ff">end</span>()) {
		<span style="color: #ae81ff">if</span> (c_iter-&gt;<span style="color: #ae81ff">expired</span>()) {
			c_iter = _contacts.<span style="color: #ae81ff">erase</span>(c_iter);
			<span style="color: #ae81ff">continue</span>;
		}
		<span style="color: #ae81ff">if</span> (c_iter-&gt;<span style="color: #ae81ff">lock</span>() == other-&gt;<span style="color: #66d9ef">GetGameObject</span>().<span style="color: #ae81ff">lock</span>()) {
			c_iter = _contacts.<span style="color: #ae81ff">erase</span>(c_iter);
			<span style="color: #ae81ff">break</span>;
		}
		c_iter++;
	}

	<span style="color: #ae81ff">if</span> (_contacts.<span style="color: #ae81ff">empty</span>()) {
		_lastGroundedTime = <span style="color: #66d9ef">MyEngine</span>::<span style="color: #66d9ef">Engine</span>::<span style="color: #66d9ef">GetInstance</span>()-&gt;<span style="color: #66d9ef">GetTime</span>();
		_isGrounded = <span style="color: #ae81ff">false</span>;
	}
}
</pre></div>
<br>
		<hr/>

		<!-- LEVEL GENERATION -->
		 <h2>
			Level Generation
		 </h2>
		<p>
			The game has one infinite level populated with blocks for the player to stand on and enemies to eliminate. 
			The infinite level effect is achieved by having three level sections, so there is always a section above and below the player.
		</p>
		<div class="project-image-container">
			<img src="images/downspace-level-sections.gif" class="project-image" style="height: 300px;"/>
			<img src="images/downspace-level-structure.png" class="project-image" style="height: 300px;"/>
		</div>
		<p>
			Each of the three level sections is responsible for the blocks and enemies inside it. 
			The section receives a string representing the layout from the Level class, then it goes through each character 
			and places a block or enemy at a location according to the character's index in the string.
		</p>
		<p>
			The blocks in the level are stored in an object pool. 
			Object pooling is a common design pattern that can help performance when creating and destroying an object is expensive.
		</p>
		<hr/>

				<!-- SPRITE BATCHING -->
				<h2>
					Sprite Batching
				</h2>
				<p>
					In the handout code we received, the engine would send each sprite to the GPU in its own draw call, which quickly became very slow.
					I reworking the engine and sprite renderer component to use sprite batching, after which we measured the average rendering time to be about 4 times faster.
				</p>
				<p>
					The sprite renderer receives a sprite batch builder that it can add its sprite to.
				</p>
					<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%; tab-size: 4;"><span style="color: #ae81ff">void</span> <span style="color: #66d9ef">ComponentRendererSprite</span>::<span style="color: #66d9ef">Render</span>(sre::<span style="color: #66d9ef">SpriteBatch</span>::<span style="color: #66d9ef">SpriteBatchBuilder</span>&amp; builder) {
	<span style="color: #ae81ff">if</span> (!_isActive) <span style="color: #ae81ff">return</span>;
	<span style="color: #ae81ff">auto</span> gameObject = <span style="color: #66d9ef">GetGameObject</span>().<span style="color: #ae81ff">lock</span>();
	<span style="color: #ae81ff">if</span> (!gameObject) <span style="color: #ae81ff">return</span>;

	glm::<span style="color: #ae81ff">vec3</span> gameObjectPos = gameObject-&gt;<span style="color: #66d9ef">GetPosition</span>();
	_sprite.<span style="color: #66d9ef">setPosition</span>({ gameObjectPos.x + _offset.x, gameObjectPos.y + _offset.y});
	builder.<span style="color: #66d9ef">addSprite</span>(_sprite);
}
</pre></div>
				<p>
					The engine's render loop uses the batch builder to render all the sprites in just one drawcall.
				</p>
									<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%; tab-size: 4;"><span style="color: #ae81ff">void</span> <span style="color: #66d9ef">Engine</span>::<span style="color: #66d9ef">Render</span>() {
	sre::<span style="color: #66d9ef">RenderPass</span> renderPass = sre::<span style="color: #66d9ef">RenderPass</span>::<span style="color: #66d9ef">create</span>()
		.<span style="color: #66d9ef">withCamera</span>(_camera)
		.<span style="color: #66d9ef">withClearColor</span>(<span style="color: #ae81ff">true</span>, _backgroundColor)
		.<span style="color: #66d9ef">build</span>();

	<span style="color: #75715e">// rendering sprites</span>
		<span style="color: #ae81ff">auto</span> builder = sre::<span style="color: #66d9ef">SpriteBatch</span>::<span style="color: #66d9ef">create</span>();

	<span style="color: #ae81ff">if</span> (<span style="color: #ae81ff">auto</span> root = _root.<span style="color: #ae81ff">lock</span>())
		root-&gt;<span style="color: #66d9ef">Render</span>(builder);

	<span style="color: #ae81ff">auto</span> world = builder.<span style="color: #66d9ef">build</span>();
	renderPass.<span style="color: #66d9ef">draw</span>(world);
}
</pre></div>
	</p>



	</div>
</div>

</body>
</html>